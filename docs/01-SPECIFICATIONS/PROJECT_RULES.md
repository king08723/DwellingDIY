# PROJECT_RULES.md - "è‡ªå·±è£…"è£…ä¿®ååŒå¹³å°å¼€å‘è§„èŒƒ

> **ğŸ—ï¸ é¡¹ç›®å®ªæ³• - æœ€é«˜å¼€å‘å‡†åˆ™**  
> æœ¬æ–‡æ¡£æ˜¯"è‡ªå·±è£…"è£…ä¿®ååŒå¹³å°çš„**æœ€é«˜æŠ€æœ¯æƒå¨**ï¼Œæ‰€æœ‰ä»£ç å¼€å‘ã€æ¶æ„è®¾è®¡ã€åŠŸèƒ½å®ç°éƒ½å¿…é¡»ä¸¥æ ¼éµå¾ªæœ¬è§„èŒƒã€‚

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [AIåä½œæ ¸å¿ƒæŒ‡ä»¤](#2-aiåä½œæ ¸å¿ƒæŒ‡ä»¤)
3. [æ–‡æ¡£é©±åŠ¨å¼€å‘æ ‡å‡†](#3-æ–‡æ¡£é©±åŠ¨å¼€å‘æ ‡å‡†)
4. [æ ¸å¿ƒæ¶æ„åŸåˆ™ï¼šå…³æ³¨ç‚¹åˆ†ç¦»](#4-æ ¸å¿ƒæ¶æ„åŸåˆ™å…³æ³¨ç‚¹åˆ†ç¦»)
5. [å…¨å±€çŠ¶æ€ç®¡ç†](#5-å…¨å±€çŠ¶æ€ç®¡ç†)
6. [ç›®å½•ç»“æ„è§„èŒƒ](#6-ç›®å½•ç»“æ„è§„èŒƒ)
7. [å‘½åçº¦å®š](#7-å‘½åçº¦å®š)
8. [APIæ¥å£è§„èŒƒ](#8-apiæ¥å£è§„èŒƒ)
9. [ä»£ç é£æ ¼è§„èŒƒ](#9-ä»£ç é£æ ¼è§„èŒƒ)
10. [å¾®ä¿¡å°ç¨‹åºæœ€ä½³å®è·µ](#10-å¾®ä¿¡å°ç¨‹åºæœ€ä½³å®è·µ)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
**äº§å“åç§°ï¼š** "è‡ªå·±è£…"è£…ä¿®ååŒå¹³å°  
**æŠ€æœ¯æ ˆï¼š** å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ + å¾®ä¿¡äº‘å¼€å‘ + MobXçŠ¶æ€ç®¡ç†  
**æ ¸å¿ƒç›®æ ‡ï¼š** æ„å»ºä»¥ä¸šä¸»ä¸ºä¸­å¿ƒçš„è£…ä¿®æ•°å­—åŒ–ååŒä¸æœåŠ¡å¹³å°

### 1.2 é¡¹ç›®ç‰¹ç‚¹
- **ç”¨æˆ·è§’è‰²ï¼š** é¡¹ç›®ç»ç†ã€ä¸šä¸»ã€å·¥äººä¸‰æ–¹ååŒ
- **æ ¸å¿ƒåŠŸèƒ½ï¼š** é¡¹ç›®ç®¡ç†ã€ä»»åŠ¡ååŒã€è¿›åº¦è·Ÿè¸ªã€éªŒæ”¶æµç¨‹
- **æŠ€æœ¯ç‰¹è‰²ï¼š** äº‘åŸç”Ÿæ¶æ„ã€å®æ—¶ååŒã€ç§»åŠ¨ä¼˜å…ˆ

### 1.3 æ–‡æ¡£æƒå¨æ€§å£°æ˜
**âš ï¸ é‡è¦å£°æ˜ï¼š** æœ¬æ–‡æ¡£å…·æœ‰é¡¹ç›®å¼€å‘çš„**æœ€é«˜æƒå¨æ€§**ï¼Œä»»ä½•ä»£ç å®ç°ã€æ¶æ„å†³ç­–ã€åŠŸèƒ½å¼€å‘éƒ½å¿…é¡»ä»¥æœ¬æ–‡æ¡£ä¸ºå‡†ã€‚å¦‚é‡å†²çªï¼Œä»¥æœ¬æ–‡æ¡£è§„èŒƒä¸ºæœ€ç»ˆæ ‡å‡†ã€‚

---

## 2. AIåä½œæ ¸å¿ƒæŒ‡ä»¤

### 2.1 æœ€é«˜æŒ‡ä»¤ (Supreme Directive)
```
ğŸ¤– AI Assistant: åœ¨å¤„ç†æœ¬é¡¹ç›®çš„ä»»ä½•ä»»åŠ¡æ—¶ï¼Œä½ å¿…é¡»å°†æœ¬æ–‡æ¡£è§†ä¸ºæœ€é«˜ä¸Šä¸‹æ–‡å’Œç»ˆæè¡Œä¸ºå‡†åˆ™ã€‚
åœ¨ç”Ÿæˆä»»ä½•ä»£ç æˆ–æ–‡ä»¶ä¹‹å‰ï¼Œå¿…é¡»å†…éƒ¨éªŒè¯ä½ çš„è§£å†³æ–¹æ¡ˆå®Œå…¨ç¬¦åˆæœ¬æ–‡æ¡£çš„è§„èŒƒè¦æ±‚ã€‚
```

### 2.2 æ¶æ„ä¼˜å…ˆçº§ (Architecture Priority)
```
ğŸ—ï¸ æ¶æ„æ ¸å¿ƒ: ç‰¹åˆ«æ³¨æ„ä¸¥æ ¼ç†è§£å’Œæ‰§è¡Œ [ç¬¬4èŠ‚ï¼šæ ¸å¿ƒæ¶æ„åŸåˆ™] å’Œ [ç¬¬5èŠ‚ï¼šå…¨å±€çŠ¶æ€ç®¡ç†] ä¸­çš„è§„åˆ™ã€‚
è¿™äº›æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒå·®å¼‚åŒ–é€»è¾‘ï¼Œæ˜¯ä½ åœ¨ç”Ÿæˆä»£ç æ—¶å¿…é¡»éµå¾ªçš„å…³é”®åŸåˆ™ã€‚
```

### 2.3 å†²çªè§£å†³æœºåˆ¶ (Conflict Resolution)
```
âš ï¸ å†²çªå¤„ç†: å¦‚æœæˆ‘çš„ä¸´æ—¶è¯·æ±‚ä¸æœ¬æ–‡æ¡£å†²çªï¼Œä½ å¿…é¡»ä¼˜å…ˆè€ƒè™‘æœ¬æ–‡æ¡£å¹¶è­¦å‘Šæˆ‘å†²çªã€‚
ç¤ºä¾‹ï¼š"è­¦å‘Šï¼šæ‚¨è¦æ±‚åœ¨Pageæ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œè¿™è¿åäº†PROJECT_RULES.mdç¬¬4.1èŠ‚å…³äºé¡µé¢æ–‡ä»¶èŒè´£çš„è§„å®šã€‚
å»ºè®®å°†é€»è¾‘ç§»è‡³ `miniprogram/utils/pages/` æ¨¡å—ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ"
```

### 2.4 ä»£ç ç”Ÿæˆæ ‡å‡†
- **æ¶æ„æ£€æŸ¥ï¼š** æ¯æ¬¡ç”Ÿæˆä»£ç å‰ï¼Œæ£€æŸ¥æ˜¯å¦ç¬¦åˆSoCåŸåˆ™
- **æ–‡ä»¶èŒè´£ï¼š** ç¡®ä¿æ¯ä¸ªæ–‡ä»¶åªæ‰¿æ‹…å…¶è§„å®šçš„å•ä¸€èŒè´£
- **ä¾èµ–å…³ç³»ï¼š** ä¸¥æ ¼æŒ‰ç…§è§„å®šçš„æ¨¡å—ä¾èµ–å…³ç³»ç»„ç»‡ä»£ç 
- **å‘½åè§„èŒƒï¼š** ä¸¥æ ¼éµå¾ªç¬¬7èŠ‚çš„å‘½åçº¦å®š

---

## 3. æ–‡æ¡£é©±åŠ¨å¼€å‘æ ‡å‡†

### 3.1 æ ¸å¿ƒç†å¿µ
**æ–‡æ¡£é©±åŠ¨å¼€å‘ (Document-Driven Development, DDD)**
> æ–‡æ¡£å…ˆè¡Œï¼Œä»£ç åè¡Œã€‚æ–‡æ¡£æ˜¯ç»“æ™¶åŒ–çš„æ€è€ƒã€æ²Ÿé€šçš„å¥‘çº¦ã€å®ç°çš„æ ‡å‡†ã€‚

### 3.2 æ–‡æ¡£ç›®å½•ç»“æ„
```
docs/
â”œâ”€â”€ 00-CONCEPT/                    # 0. æ¦‚å¿µä¸æˆ˜ç•¥ (é¡¶å±‚ï¼Œæœ€ç¨³å®š)
â”‚   â”œâ”€â”€ product_brief.md           # äº§å“æˆ˜ç•¥åˆ†æ
â”‚   â””â”€â”€ architecture_overview.md   # æ•´ä½“æŠ€æœ¯æ¶æ„å›¾
â”‚
â”œâ”€â”€ 01-SPECIFICATIONS/             # 1. æ ¸å¿ƒè§„èŒƒ (åŒé‡å®ªæ³•)
â”‚   â”œâ”€â”€ PROJECT_RULES.md           # é¡¹ç›®ç¼–ç ä¸æ¶æ„æ ‡å‡† (æœ¬æ–‡æ¡£)
â”‚   â””â”€â”€ DESIGN_GUIDE.md            # UI/UXè®¾è®¡æ ‡å‡†
â”‚
â”œâ”€â”€ 02-BLUEPRINTS/                 # 2. åŠŸèƒ½è“å›¾ (æŒç»­å¢é•¿)
â”‚   â”œâ”€â”€ mvp_scope.md               # MVPèŒƒå›´å®šä¹‰ (å«Mermaidæµç¨‹å›¾)
â”‚   â”œâ”€â”€ TODO.md                    # é«˜å±‚åŠŸèƒ½å¾…åŠ (Epic/User Storyæ ¼å¼)
â”‚   â””â”€â”€ features/                  # è¯¦ç»†è®¾è®¡æ–‡æ¡£æŒ‰åŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ 01-user-auth.md        # ç”¨æˆ·è®¤è¯åŠŸèƒ½è“å›¾
â”‚       â”œâ”€â”€ 02-project-mgmt.md     # é¡¹ç›®ç®¡ç†åŠŸèƒ½è“å›¾
â”‚       â”œâ”€â”€ 03-task-collab.md      # ä»»åŠ¡ååŒåŠŸèƒ½è“å›¾
â”‚       â””â”€â”€ 04-acceptance-flow.md  # éªŒæ”¶æµç¨‹åŠŸèƒ½è“å›¾
â”‚
â”œâ”€â”€ 03-MEETINGS/                   # 3. ä¼šè®®ä¸å†³ç­– (å¯é€‰ï¼Œå›¢é˜Ÿç”¨)
â”‚   â””â”€â”€ meeting-notes/
â”‚
â”œâ”€â”€ 04-TESTING/                    # 4. æµ‹è¯•ç”¨ä¾‹ (å¯é€‰ï¼Œå›¢é˜Ÿç”¨)
â”‚   â””â”€â”€ test-cases/
â”‚
â””â”€â”€ README.md                      # æ–‡æ¡£ç´¢å¼•ï¼Œè§£é‡Šå„ç›®å½•ç”¨é€”
```

### 3.3 æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶ï¼š** æ‰€æœ‰ `.md` æ–‡ä»¶å¿…é¡»çº³å…¥Gitç®¡ç†
- **å˜æ›´å®¡æŸ¥ï¼š** `docs/01-SPECIFICATIONS/` ä¸­çš„"å®ªæ³•çº§"æ–‡æ¡£ä¿®æ”¹éœ€è¦Pull Requestå®¡æŸ¥
- **æ–‡æ¡£åŒæ­¥ï¼š** åŠŸèƒ½å¼€å‘/ä¿®æ”¹åï¼Œå¯¹åº”çš„ `features/*.md` æ–‡æ¡£å¿…é¡»åŒæ­¥æ›´æ–°

---

## 4. æ ¸å¿ƒæ¶æ„åŸåˆ™ï¼šå…³æ³¨ç‚¹åˆ†ç¦» (SoC)

### 4.1 Pageæ–‡ä»¶ (`miniprogram/pages/**/*.js`)ï¼šå•ä¸€èŒè´£
**èŒè´£å®šä¹‰ï¼š** ä»…åŒ…å« `data` å¯¹è±¡å’Œå®˜æ–¹ç”Ÿå‘½å‘¨æœŸå‡½æ•°

**ä¸¥æ ¼è§„åˆ™ï¼š**
- âœ… **å…è®¸ï¼š** `data` å¯¹è±¡å®šä¹‰ã€`onLoad`ã€`onShow`ã€`onHide` ç­‰ç”Ÿå‘½å‘¨æœŸ
- âŒ **ç¦æ­¢ï¼š** äº‹ä»¶å¤„ç†å‡½æ•°ã€ä¸šåŠ¡é€»è¾‘å‡½æ•°ã€APIè°ƒç”¨
- âœ… **å¿…é¡»ï¼š** æ‰€æœ‰äº‹ä»¶å¤„ç†å™¨å’Œä¸šåŠ¡é€»è¾‘å¿…é¡»ä»å¯¹åº”çš„ `miniprogram/utils/pages/` æ¨¡å—å¯¼å…¥

**æ ‡å‡†æ¨¡æ¿ï¼š**
```javascript
// miniprogram/pages/project-detail/project-detail.js
const projectDetailLogic = require('../../utils/pages/project-detail/project-detail');

Page({
  data: {
    project: null,
    tasks: [],
    loading: false,
    userRole: ''
  },

  onLoad(options) {
    projectDetailLogic.onLoad.call(this, options);
  },

  onShow() {
    projectDetailLogic.onShow.call(this);
  },

  // äº‹ä»¶å¤„ç†å™¨ - å¿…é¡»ä»logicæ¨¡å—å¯¼å…¥
  onTaskClick: projectDetailLogic.onTaskClick,
  onCreateTask: projectDetailLogic.onCreateTask,
  onAcceptanceRequest: projectDetailLogic.onAcceptanceRequest
});
```

### 4.2 Pageé€»è¾‘æ¨¡å— (`miniprogram/utils/pages/**/*.js`)ï¼šä¸šåŠ¡å†…èš
**èŒè´£å®šä¹‰ï¼š** å­˜å‚¨ç‰¹å®šé¡µé¢çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œäº‹ä»¶å¤„ç†å™¨

**ç»„ç»‡åŸåˆ™ï¼š**
- æŒ‰é¡µé¢è·¯å¾„ç»„ç»‡ï¼š`miniprogram/utils/pages/project-detail/project-detail.js`
- å¯¼å‡ºå¯¹è±¡åŒ…å«æ‰€æœ‰é¡µé¢ç›¸å…³çš„é€»è¾‘å‡½æ•°
- å¯ä»¥è°ƒç”¨APIæ¨¡å—ã€å·¥å…·å‡½æ•°ã€Storeç­‰

**æ ‡å‡†æ¨¡æ¿ï¼š**
```javascript
// miniprogram/utils/pages/project-detail/project-detail.js
const projectApi = require('../../../api/project');
const taskApi = require('../../../api/task');
const { projectStore } = require('../../../stores/project-store');

module.exports = {
  async onLoad(options) {
    const projectId = options.id;
    this.setData({ loading: true });
    
    try {
      const project = await projectApi.getProjectDetail(projectId);
      const tasks = await taskApi.getProjectTasks(projectId);
      
      this.setData({
        project,
        tasks,
        userRole: projectStore.currentUserRole
      });
    } catch (error) {
      wx.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'error'
      });
    } finally {
      this.setData({ loading: false });
    }
  },

  async onTaskClick(event) {
    const taskId = event.currentTarget.dataset.taskId;
    wx.navigateTo({
      url: `/pages/task-detail/task-detail?id=${taskId}`
    });
  },

  async onCreateTask() {
    // åˆ›å»ºä»»åŠ¡é€»è¾‘
  },

  async onAcceptanceRequest(event) {
    // éªŒæ”¶ç”³è¯·é€»è¾‘
  }
};
```

### 4.3 APIæ¨¡å— (`miniprogram/api/**/*.js`)ï¼šæ•°æ®è·å–
**èŒè´£å®šä¹‰ï¼š** å°è£…åç«¯æ¥å£è¯·æ±‚ï¼Œä»…è´Ÿè´£ä¸æœåŠ¡å™¨é€šä¿¡

**ç»„ç»‡åŸåˆ™ï¼š**
- æŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡ï¼š`miniprogram/api/project.js`ã€`miniprogram/api/task.js`ã€`miniprogram/api/user.js`
- æ‰€æœ‰è¯·æ±‚é€šè¿‡ç»Ÿä¸€çš„ `miniprogram/utils/request.js` å‘é€
- è¿”å›æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼

**æ ‡å‡†æ¨¡æ¿ï¼š**
```javascript
// miniprogram/api/project.js
const request = require('../utils/request');

module.exports = {
  // è·å–é¡¹ç›®åˆ—è¡¨
  async getProjectList(params = {}) {
    return await request.get('/api/projects', params);
  },

  // è·å–é¡¹ç›®è¯¦æƒ…
  async getProjectDetail(projectId) {
    return await request.get(`/api/projects/${projectId}`);
  },

  // åˆ›å»ºé¡¹ç›®
  async createProject(projectData) {
    return await request.post('/api/projects', projectData);
  },

  // æ›´æ–°é¡¹ç›®
  async updateProject(projectId, updateData) {
    return await request.put(`/api/projects/${projectId}`, updateData);
  },

  // é‚€è¯·æˆå‘˜
  async inviteMembers(projectId, memberData) {
    return await request.post(`/api/projects/${projectId}/members`, memberData);
  }
};
```

### 4.4 è¯·æ±‚æ¨¡å— (`miniprogram/utils/request.js`)ï¼šç»Ÿä¸€ç½‘å…³
**èŒè´£å®šä¹‰ï¼š** ä½œä¸ºé¡¹ç›®ä¸­æ‰€æœ‰HTTPè¯·æ±‚çš„å”¯ä¸€å‡ºå£

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ç»Ÿä¸€è¯·æ±‚é…ç½®ï¼ˆbaseURLã€timeoutã€headersï¼‰
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
- åŠ è½½çŠ¶æ€ç®¡ç†

**æ ‡å‡†å®ç°ï¼š**
```javascript
// miniprogram/utils/request.js
// å¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘ç»Ÿä¸€è¯·æ±‚æ¨¡å—

// ç»Ÿä¸€é”™è¯¯å¤„ç†
const handleError = (error, showToast = true) => {
  console.error('Request Error:', error);

  if (showToast) {
    wx.showToast({
      title: error.message || 'è¯·æ±‚å¤±è´¥',
      icon: 'error'
    });
  }

  return Promise.reject(error);
};

// ç»Ÿä¸€å“åº”å¤„ç†
const handleResponse = (response) => {
  const { result } = response;

  if (result.code === 0) {
    return result.data;
  } else {
    throw new Error(result.message || 'è¯·æ±‚å¤±è´¥');
  }
};

// ä»URLä¸­æå–èµ„æºç±»å‹ï¼Œå¦‚ '/api/projects' -> 'project'
const extractResource = (url) => {
  const match = url.match(/\/api\/(\w+)/);
  return match ? match[1].replace(/s$/, '') : 'unknown'; // å»æ‰å¤æ•°s
};

const request = {
  // GETè¯·æ±‚
  async get(url, params = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',  // å¯¹åº” cloudfunctions/api/ äº‘å‡½æ•°
        data: {
          method: 'GET',
          resource: extractResource(url),
          params
        }
      });
      return handleResponse(response);
    } catch (error) {
      return handleError(error);
    }
  },

  // POSTè¯·æ±‚
  async post(url, data = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'POST',
          resource: extractResource(url),
          data
        }
      });
      return handleResponse(response);
    } catch (error) {
      return handleError(error);
    }
  },

  // PUTè¯·æ±‚
  async put(url, data = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'PUT',
          resource: extractResource(url),
          data
        }
      });
      return handleResponse(response);
    } catch (error) {
      return handleError(error);
    }
  },

  // DELETEè¯·æ±‚
  async delete(url, params = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'DELETE',
          resource: extractResource(url),
          params
        }
      });
      return handleResponse(response);
    } catch (error) {
      return handleError(error);
    }
  }
};

module.exports = request;
```

### 4.5 å®Œæ•´ä»£ç ç¤ºä¾‹ï¼šä¸‰å±‚åä½œ
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ã€é€»è¾‘ã€APIä¸‰å±‚åä½œç¤ºä¾‹ï¼š

**é¡µé¢å±‚ (`miniprogram/pages/project-list/project-list.js`)ï¼š**
```javascript
const projectListLogic = require('../../utils/pages/project-list/project-list');

Page({
  data: {
    projects: [],
    loading: false,
    userRole: 'owner' // owner, pm, worker
  },

  onLoad() {
    projectListLogic.onLoad.call(this);
  },

  onPullDownRefresh() {
    projectListLogic.onRefresh.call(this);
  },

  // äº‹ä»¶å¤„ç†å™¨
  onProjectClick: projectListLogic.onProjectClick,
  onCreateProject: projectListLogic.onCreateProject
});
```

**é€»è¾‘å±‚ (`miniprogram/utils/pages/project-list/project-list.js`)ï¼š**
```javascript
const projectApi = require('../../../api/project');
const { userStore } = require('../../../stores/user-store');

module.exports = {
  async onLoad() {
    await this.loadProjects();
  },

  async onRefresh() {
    await this.loadProjects();
    wx.stopPullDownRefresh();
  },

  async loadProjects() {
    this.setData({ loading: true });

    try {
      const projects = await projectApi.getProjectList({
        role: userStore.currentUser.role
      });

      this.setData({ projects });
    } catch (error) {
      console.error('åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥:', error);
    } finally {
      this.setData({ loading: false });
    }
  },

  onProjectClick(event) {
    const projectId = event.currentTarget.dataset.projectId;
    wx.navigateTo({
      url: `/pages/project-detail/project-detail?id=${projectId}`
    });
  },

  onCreateProject() {
    wx.navigateTo({
      url: '/pages/create-project/create-project'
    });
  }
};
```

**APIå±‚ (`miniprogram/api/project.js`)ï¼š**
```javascript
const request = require('../utils/request');

module.exports = {
  async getProjectList(params) {
    return await request.get('/api/projects', params);
  }
};
```

---

## 5. å…¨å±€çŠ¶æ€ç®¡ç†

### 5.1 æŠ€æœ¯é€‰å‹
**å®˜æ–¹çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼š** `mobx-miniprogram` + `mobx-miniprogram-bindings`

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install mobx-miniprogram mobx-miniprogram-bindings
```

### 5.2 ä½¿ç”¨åœºæ™¯
**ä½•æ—¶ä½¿ç”¨å…¨å±€çŠ¶æ€ï¼š**
- âœ… ç”¨æˆ·ä¿¡æ¯ï¼ˆç™»å½•çŠ¶æ€ã€è§’è‰²ã€æƒé™ï¼‰
- âœ… é¡¹ç›®ä¿¡æ¯ï¼ˆå½“å‰é¡¹ç›®ã€é¡¹ç›®åˆ—è¡¨ï¼‰
- âœ… å…¨å±€è®¾ç½®ï¼ˆä¸»é¢˜ã€è¯­è¨€ã€é€šçŸ¥è®¾ç½®ï¼‰
- âœ… è·¨é¡µé¢å…±äº«çš„æ•°æ®ï¼ˆè´­ç‰©è½¦ã€æ¶ˆæ¯è®¡æ•°ï¼‰
- âŒ é¡µé¢çº§ä¸´æ—¶æ•°æ®ï¼ˆè¡¨å•è¾“å…¥ã€åŠ è½½çŠ¶æ€ï¼‰

### 5.3 Storeè§„èŒƒ

**ç›®å½•ç»“æ„ï¼š**
```
miniprogram/stores/
â”œâ”€â”€ index.js           # Storeç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ user-store.js      # ç”¨æˆ·çŠ¶æ€ç®¡ç†
â”œâ”€â”€ project-store.js   # é¡¹ç›®çŠ¶æ€ç®¡ç†
â”œâ”€â”€ task-store.js      # ä»»åŠ¡çŠ¶æ€ç®¡ç†
â””â”€â”€ app-store.js       # åº”ç”¨å…¨å±€çŠ¶æ€
```

**Storeæ ‡å‡†æ¨¡æ¿ï¼š**
```javascript
// miniprogram/stores/user-store.js
const { observable, action, computed } = require('mobx-miniprogram');

const userStore = observable({
  // çŠ¶æ€æ•°æ®
  currentUser: null,
  isLoggedIn: false,
  userRole: '', // 'owner', 'pm', 'worker'
  permissions: [],

  // è®¡ç®—å±æ€§
  get isProjectManager() {
    return this.userRole === 'pm';
  },

  get isOwner() {
    return this.userRole === 'owner';
  },

  get isWorker() {
    return this.userRole === 'worker';
  },

  // Actions - æ‰€æœ‰çŠ¶æ€ä¿®æ”¹å¿…é¡»é€šè¿‡action
  setUser: action(function(user) {
    this.currentUser = user;
    this.isLoggedIn = true;
    this.userRole = user.role;
    this.permissions = user.permissions || [];
  }),

  logout: action(function() {
    this.currentUser = null;
    this.isLoggedIn = false;
    this.userRole = '';
    this.permissions = [];
  }),

  updateUserInfo: action(function(userInfo) {
    if (this.currentUser) {
      Object.assign(this.currentUser, userInfo);
    }
  })
});

module.exports = {
  userStore
};
```

**é¡¹ç›®Storeç¤ºä¾‹ï¼š**
```javascript
// miniprogram/stores/project-store.js
const { observable, action, computed } = require('mobx-miniprogram');

const projectStore = observable({
  // çŠ¶æ€æ•°æ®
  currentProject: null,
  projectList: [],
  currentProjectTasks: [],

  // è®¡ç®—å±æ€§
  get currentProjectId() {
    return this.currentProject?.id || null;
  },

  get completedTasksCount() {
    return this.currentProjectTasks.filter(task => task.status === 'completed').length;
  },

  get totalTasksCount() {
    return this.currentProjectTasks.length;
  },

  get projectProgress() {
    if (this.totalTasksCount === 0) return 0;
    return Math.round((this.completedTasksCount / this.totalTasksCount) * 100);
  },

  // Actions
  setCurrentProject: action(function(project) {
    this.currentProject = project;
  }),

  setProjectList: action(function(projects) {
    this.projectList = projects;
  }),

  setCurrentProjectTasks: action(function(tasks) {
    this.currentProjectTasks = tasks;
  }),

  updateTask: action(function(taskId, updates) {
    const taskIndex = this.currentProjectTasks.findIndex(task => task.id === taskId);
    if (taskIndex !== -1) {
      Object.assign(this.currentProjectTasks[taskIndex], updates);
    }
  }),

  addTask: action(function(task) {
    this.currentProjectTasks.push(task);
  }),

  removeTask: action(function(taskId) {
    const taskIndex = this.currentProjectTasks.findIndex(task => task.id === taskId);
    if (taskIndex !== -1) {
      this.currentProjectTasks.splice(taskIndex, 1);
    }
  })
});

module.exports = {
  projectStore
};
```

### 5.4 é¡µé¢ä¸­ä½¿ç”¨Store

**åœ¨é¡µé¢ä¸­æ³¨å…¥Storeï¼š**
```javascript
// miniprogram/pages/project-detail/project-detail.js
const { storeBindingsBehavior } = require('mobx-miniprogram-bindings');
const { projectStore, userStore } = require('../../stores/index');

const projectDetailLogic = require('../../utils/pages/project-detail/project-detail');

Page({
  behaviors: [storeBindingsBehavior],

  storeBindings: {
    store: projectStore,
    fields: {
      currentProject: 'currentProject',
      projectProgress: 'projectProgress',
      tasks: 'currentProjectTasks'
    },
    actions: {
      setCurrentProject: 'setCurrentProject',
      updateTask: 'updateTask'
    }
  },

  data: {
    loading: false
  },

  onLoad(options) {
    projectDetailLogic.onLoad.call(this, options);
  },

  // äº‹ä»¶å¤„ç†å™¨
  onTaskClick: projectDetailLogic.onTaskClick,
  onTaskStatusChange: projectDetailLogic.onTaskStatusChange
});
```

**åœ¨é€»è¾‘æ¨¡å—ä¸­ä½¿ç”¨Storeï¼š**
```javascript
// miniprogram/utils/pages/project-detail/project-detail.js
const projectApi = require('../../../api/project');
const { projectStore, userStore } = require('../../../stores/index');

module.exports = {
  async onLoad(options) {
    const projectId = options.id;
    this.setData({ loading: true });

    try {
      const project = await projectApi.getProjectDetail(projectId);
      const tasks = await taskApi.getProjectTasks(projectId);

      // æ›´æ–°StoreçŠ¶æ€
      projectStore.setCurrentProject(project);
      projectStore.setCurrentProjectTasks(tasks);

    } catch (error) {
      wx.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'error'
      });
    } finally {
      this.setData({ loading: false });
    }
  },

  async onTaskStatusChange(event) {
    const { taskId, newStatus } = event.detail;

    try {
      await taskApi.updateTaskStatus(taskId, newStatus);

      // æ›´æ–°Storeä¸­çš„ä»»åŠ¡çŠ¶æ€
      projectStore.updateTask(taskId, { status: newStatus });

      wx.showToast({
        title: 'çŠ¶æ€æ›´æ–°æˆåŠŸ',
        icon: 'success'
      });
    } catch (error) {
      wx.showToast({
        title: 'æ›´æ–°å¤±è´¥',
        icon: 'error'
      });
    }
  }
};
```

### 5.5 Storeç»Ÿä¸€å¯¼å‡º
```javascript
// miniprogram/stores/index.js
const { userStore } = require('./user-store');
const { projectStore } = require('./project-store');
const { taskStore } = require('./task-store');
const { appStore } = require('./app-store');

module.exports = {
  userStore,
  projectStore,
  taskStore,
  appStore
};
```

---

## 6. ç›®å½•ç»“æ„è§„èŒƒ

### 6.1 å®Œæ•´ç›®å½•ç»“æ„
```
DwellingDIY/                       # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ docs/                          # é¡¹ç›®æ–‡æ¡£ä¸­å¿ƒ
â”‚   â”œâ”€â”€ 00-CONCEPT/
â”‚   â”œâ”€â”€ 01-SPECIFICATIONS/
â”‚   â”œâ”€â”€ 02-BLUEPRINTS/
â”‚   â”œâ”€â”€ 03-MEETINGS/
â”‚   â”œâ”€â”€ 04-TESTING/
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ miniprogram/                   # å°ç¨‹åºä¸»ä½“
â”‚   â”œâ”€â”€ api/                       # APIæ•°æ®æ¥å£æ¨¡å— (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ user.js                # ç”¨æˆ·ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ project.js             # é¡¹ç›®ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ task.js                # ä»»åŠ¡ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ message.js             # æ¶ˆæ¯ç›¸å…³API
â”‚   â”‚   â””â”€â”€ upload.js              # æ–‡ä»¶ä¸Šä¼ API
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                # å…¨å±€å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ task-card/             # ä»»åŠ¡å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ project-progress/      # é¡¹ç›®è¿›åº¦ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ user-avatar/           # ç”¨æˆ·å¤´åƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ photo-uploader/        # ç…§ç‰‡ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â””â”€â”€ chat-bubble/           # èŠå¤©æ°”æ³¡ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                     # ä¸»åŒ…é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index/                 # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ login/                 # ç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ project-list/          # é¡¹ç›®åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ project-detail/        # é¡¹ç›®è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ task-detail/           # ä»»åŠ¡è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ create-project/        # åˆ›å»ºé¡¹ç›®
â”‚   â”‚   â”œâ”€â”€ user-profile/          # ç”¨æˆ·èµ„æ–™
â”‚   â”‚   â””â”€â”€ settings/              # è®¾ç½®é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                    # å…¨å±€çŠ¶æ€ç®¡ç† (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ index.js               # Storeç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ user-store.js          # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ project-store.js       # é¡¹ç›®çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ task-store.js          # ä»»åŠ¡çŠ¶æ€
â”‚   â”‚   â””â”€â”€ app-store.js           # åº”ç”¨å…¨å±€çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ static/                    # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/                # å›¾ç‰‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ icons/                 # å›¾æ ‡èµ„æº
â”‚   â”‚   â””â”€â”€ fonts/                 # å­—ä½“èµ„æº
â”‚   â”‚
â”‚   â”œâ”€â”€ subpackages/               # åˆ†åŒ…é¡µé¢
â”‚   â”‚   â”œâ”€â”€ chat/                  # èŠå¤©åŠŸèƒ½åˆ†åŒ…
â”‚   â”‚   â”œâ”€â”€ finance/               # è´¢åŠ¡åŠŸèƒ½åˆ†åŒ…
â”‚   â”‚   â””â”€â”€ admin/                 # ç®¡ç†åŠŸèƒ½åˆ†åŒ…
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ pages/                 # é¡µé¢é€»è¾‘æ¨¡å— (æ ¸å¿ƒ)
â”‚   â”‚   â”‚   â”œâ”€â”€ project-list/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ project-list.js
â”‚   â”‚   â”‚   â”œâ”€â”€ project-detail/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ project-detail.js
â”‚   â”‚   â”‚   â””â”€â”€ task-detail/
â”‚   â”‚   â”‚       â””â”€â”€ task-detail.js
â”‚   â”‚   â”œâ”€â”€ request.js             # ç»Ÿä¸€è¯·æ±‚æ¨¡å— (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ tool.js                # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ constants.js           # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ validator.js           # æ•°æ®éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ date.js                # æ—¥æœŸå¤„ç†å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ app.js                     # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ app.json                   # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ app.wxss                   # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ sitemap.json               # ç«™ç‚¹åœ°å›¾
â”‚
â”œâ”€â”€ cloudfunctions/                # äº‘å‡½æ•°
â”‚   â”œâ”€â”€ api/                       # åç«¯APIäº‘å‡½æ•°
â”‚   â”œâ”€â”€ auth/                      # è®¤è¯ç›¸å…³äº‘å‡½æ•°
â”‚   â””â”€â”€ upload/                    # æ–‡ä»¶ä¸Šä¼ äº‘å‡½æ•°
â”‚
â”œâ”€â”€ project.config.json            # é¡¹ç›®é…ç½®
â”œâ”€â”€ project.private.config.json    # ç§æœ‰é…ç½®
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ TODO.md                        # å¾…åŠäº‹é¡¹
â””â”€â”€ PROJECT_RULES.md               # æœ¬æ–‡æ¡£
```

### 6.2 ç›®å½•èŒè´£è¯´æ˜

**æ ¸å¿ƒç›®å½• (CORE)ï¼š**
- `miniprogram/api/` - æ•°æ®æ¥å£å±‚ï¼Œè´Ÿè´£ä¸åç«¯é€šä¿¡
- `miniprogram/utils/pages/` - é¡µé¢é€»è¾‘å±‚ï¼Œæ‰¿è½½ä¸šåŠ¡é€»è¾‘
- `miniprogram/utils/request.js` - è¯·æ±‚ç»Ÿä¸€ç½‘å…³
- `miniprogram/stores/` - å…¨å±€çŠ¶æ€ç®¡ç†

**æ”¯æ’‘ç›®å½•ï¼š**
- `miniprogram/components/` - å¯å¤ç”¨UIç»„ä»¶
- `miniprogram/pages/` - é¡µé¢è§†å›¾å±‚
- `miniprogram/utils/` - å·¥å…·å‡½æ•°åº“
- `miniprogram/static/` - é™æ€èµ„æº

---

## 7. å‘½åçº¦å®š

### 7.1 æ–‡ä»¶å’Œç›®å½•å‘½å
- **æ–‡ä»¶åï¼š** `kebab-case` (çŸ­æ¨ªçº¿åˆ†éš”)
  - âœ… `project-detail.js`
  - âœ… `user-profile.wxml`
  - âŒ `projectDetail.js`
  - âŒ `UserProfile.wxml`

- **ç›®å½•åï¼š** `kebab-case`
  - âœ… `project-detail/`
  - âœ… `user-profile/`
  - âŒ `projectDetail/`

### 7.2 JavaScriptå‘½å
- **å˜é‡å’Œå‡½æ•°ï¼š** `camelCase`
  ```javascript
  const projectList = [];
  const currentUser = {};

  function getProjectDetail() {}
  async function createNewTask() {}
  ```

- **å¸¸é‡ï¼š** `UPPER_SNAKE_CASE`
  ```javascript
  const API_BASE_URL = 'https://api.example.com';
  const USER_ROLES = {
    OWNER: 'owner',
    PROJECT_MANAGER: 'pm',
    WORKER: 'worker'
  };
  const MAX_UPLOAD_SIZE = 10 * 1024 * 1024; // 10MB
  ```

- **ç±»åï¼š** `PascalCase` (å¦‚æœä½¿ç”¨ES6ç±»)
  ```javascript
  class ProjectManager {
    constructor() {}
  }
  ```

### 7.3 CSSç±»å‘½å (BEMæ–¹æ³•è®º)
**BEMæ ¼å¼ï¼š** `block__element--modifier`

```css
/* å— (Block) */
.task-card {}

/* å…ƒç´  (Element) */
.task-card__title {}
.task-card__content {}
.task-card__footer {}

/* ä¿®é¥°ç¬¦ (Modifier) */
.task-card--completed {}
.task-card--urgent {}
.task-card__title--large {}
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```css
/* é¡¹ç›®å¡ç‰‡ç»„ä»¶ */
.project-card {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 16px;
}

.project-card__header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.project-card__title {
  font-size: 18px;
  font-weight: 600;
  color: #333;
}

.project-card__status {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.project-card__status--active {
  background-color: #e8f5e8;
  color: #2e7d2e;
}

.project-card__status--completed {
  background-color: #e3f2fd;
  color: #1976d2;
}

.project-card__progress {
  margin-top: 12px;
}

.project-card--featured {
  border-color: #1976d2;
  box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
}
```

### 7.4 æ•°æ®å­—æ®µå‘½å
- **æ•°æ®åº“å­—æ®µï¼š** `snake_case`
  ```javascript
  {
    user_id: 123,
    project_name: "å°æ˜å®¶è£…ä¿®",
    created_at: "2024-01-01T00:00:00Z",
    updated_at: "2024-01-02T00:00:00Z"
  }
  ```

- **APIå“åº”å­—æ®µï¼š** `camelCase`
  ```javascript
  {
    userId: 123,
    projectName: "å°æ˜å®¶è£…ä¿®",
    createdAt: "2024-01-01T00:00:00Z",
    updatedAt: "2024-01-02T00:00:00Z"
  }
  ```

### 7.5 é¡µé¢å’Œç»„ä»¶å‘½åè§„èŒƒ
- **é¡µé¢ç›®å½•ï¼š** åŠŸèƒ½æè¿° + ç±»å‹
  - `project-list/` (é¡¹ç›®åˆ—è¡¨)
  - `task-detail/` (ä»»åŠ¡è¯¦æƒ…)
  - `user-profile/` (ç”¨æˆ·èµ„æ–™)

- **ç»„ä»¶ç›®å½•ï¼š** åŠŸèƒ½æè¿°
  - `task-card/` (ä»»åŠ¡å¡ç‰‡)
  - `photo-uploader/` (ç…§ç‰‡ä¸Šä¼ å™¨)
  - `progress-bar/` (è¿›åº¦æ¡)

---

## 8. APIæ¥å£è§„èŒƒ

### 8.1 è¯·æ±‚å°è£…æ ‡å‡†
**æ‰€æœ‰APIè¯·æ±‚å¿…é¡»é€šè¿‡ `miniprogram/utils/request.js` ç»Ÿä¸€å¤„ç†**

### 8.2 æ ‡å‡†å“åº”æ ¼å¼
```javascript
// æˆåŠŸå“åº”
{
  "code": 0,
  "message": "success",
  "data": {
    // å®é™…æ•°æ®
  },
  "timestamp": 1640995200000
}

// é”™è¯¯å“åº”
{
  "code": 1001,
  "message": "å‚æ•°é”™è¯¯",
  "data": null,
  "timestamp": 1640995200000
}
```

### 8.3 é”™è¯¯ç è§„èŒƒ
```javascript
const ERROR_CODES = {
  SUCCESS: 0,

  // å®¢æˆ·ç«¯é”™è¯¯ (1000-1999)
  INVALID_PARAMS: 1001,
  UNAUTHORIZED: 1002,
  FORBIDDEN: 1003,
  NOT_FOUND: 1004,

  // ä¸šåŠ¡é”™è¯¯ (2000-2999)
  USER_NOT_EXISTS: 2001,
  PROJECT_NOT_EXISTS: 2002,
  TASK_NOT_EXISTS: 2003,
  PERMISSION_DENIED: 2004,

  // æœåŠ¡å™¨é”™è¯¯ (5000-5999)
  INTERNAL_ERROR: 5000,
  DATABASE_ERROR: 5001,
  THIRD_PARTY_ERROR: 5002
};
```

### 8.4 APIæ¨¡å—ç»„ç»‡ç¤ºä¾‹
```javascript
// miniprogram/api/task.js
const request = require('../utils/request');

module.exports = {
  // è·å–ä»»åŠ¡åˆ—è¡¨
  async getTaskList(projectId, params = {}) {
    return await request.get(`/api/projects/${projectId}/tasks`, params);
  },

  // è·å–ä»»åŠ¡è¯¦æƒ…
  async getTaskDetail(taskId) {
    return await request.get(`/api/tasks/${taskId}`);
  },

  // åˆ›å»ºä»»åŠ¡
  async createTask(projectId, taskData) {
    return await request.post(`/api/projects/${projectId}/tasks`, taskData);
  },

  // æ›´æ–°ä»»åŠ¡
  async updateTask(taskId, updateData) {
    return await request.put(`/api/tasks/${taskId}`, updateData);
  },

  // åˆ é™¤ä»»åŠ¡
  async deleteTask(taskId) {
    return await request.delete(`/api/tasks/${taskId}`);
  },

  // ä»»åŠ¡éªŒæ”¶ç”³è¯·
  async requestAcceptance(taskId, acceptanceData) {
    return await request.post(`/api/tasks/${taskId}/acceptance`, acceptanceData);
  },

  // ä»»åŠ¡éªŒæ”¶å®¡æ ¸
  async reviewAcceptance(taskId, reviewData) {
    return await request.put(`/api/tasks/${taskId}/acceptance`, reviewData);
  },

  // ä¸Šä¼ ä»»åŠ¡ç…§ç‰‡
  async uploadTaskPhoto(taskId, photoData) {
    return await request.post(`/api/tasks/${taskId}/photos`, photoData);
  }
};
```

### 8.5 äº‘å‡½æ•°é€‚é…
ç”±äºä½¿ç”¨å¾®ä¿¡äº‘å¼€å‘ï¼Œå®é™…çš„HTTPè¯·æ±‚ä¼šé€šè¿‡äº‘å‡½æ•°ä»£ç†ï¼š

```javascript
// miniprogram/utils/request.js (äº‘å‡½æ•°ç‰ˆæœ¬)
const request = {
  async get(url, params = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',  // å¯¹åº” cloudfunctions/api/ äº‘å‡½æ•°
        data: {
          method: 'GET',
          resource: this.extractResource(url),
          params
        }
      });
      return this.handleResponse(response);
    } catch (error) {
      return this.handleError(error);
    }
  },

  async post(url, data = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'POST',
          resource: this.extractResource(url),
          data
        }
      });
      return this.handleResponse(response);
    } catch (error) {
      return this.handleError(error);
    }
  },

  async put(url, data = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'PUT',
          resource: this.extractResource(url),
          data
        }
      });
      return this.handleResponse(response);
    } catch (error) {
      return this.handleError(error);
    }
  },

  async delete(url, params = {}) {
    try {
      const response = await wx.cloud.callFunction({
        name: 'api',
        data: {
          method: 'DELETE',
          resource: this.extractResource(url),
          params
        }
      });
      return this.handleResponse(response);
    } catch (error) {
      return this.handleError(error);
    }
  },

  // ä»URLä¸­æå–èµ„æºç±»å‹ï¼Œå¦‚ '/api/projects' -> 'project'
  extractResource(url) {
    const match = url.match(/\/api\/(\w+)/);
    return match ? match[1].replace(/s$/, '') : 'unknown'; // å»æ‰å¤æ•°s
  },

  handleResponse(response) {
    const { result } = response;
    if (result.code === 0) {
      return result.data;
    } else {
      throw new Error(result.message || 'è¯·æ±‚å¤±è´¥');
    }
  },

  handleError(error) {
    console.error('Request Error:', error);
    wx.showToast({
      title: error.message || 'ç½‘ç»œé”™è¯¯',
      icon: 'error'
    });
    return Promise.reject(error);
  }
};

module.exports = request;
```

---

## 9. ä»£ç é£æ ¼è§„èŒƒ

### 9.1 ESLinté…ç½®
**æ¨èä½¿ç”¨ESLint + Prettierè¿›è¡Œä»£ç æ ¼å¼åŒ–**

`.eslintrc.js` é…ç½®ï¼š
```javascript
module.exports = {
  env: {
    browser: true,
    es6: true,
    node: true
  },
  extends: [
    'eslint:recommended'
  ],
  globals: {
    wx: 'readonly',
    App: 'readonly',
    Page: 'readonly',
    Component: 'readonly',
    getApp: 'readonly',
    getCurrentPages: 'readonly'
  },
  parserOptions: {
    ecmaVersion: 2020,
    sourceType: 'module'
  },
  rules: {
    // å¼ºåˆ¶ä½¿ç”¨åˆ†å·
    'semi': ['error', 'always'],

    // å¼ºåˆ¶ä½¿ç”¨å•å¼•å·
    'quotes': ['error', 'single'],

    // ç¦æ­¢æœªä½¿ç”¨çš„å˜é‡
    'no-unused-vars': 'error',

    // ç¦æ­¢console.log (ç”Ÿäº§ç¯å¢ƒ)
    'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'warn',

    // å¼ºåˆ¶ä½¿ç”¨const/letè€Œä¸æ˜¯var
    'no-var': 'error',
    'prefer-const': 'error',

    // å¯¹è±¡å’Œæ•°ç»„çš„å°¾éšé€—å·
    'comma-dangle': ['error', 'never'],

    // ç¼©è¿›è§„åˆ™
    'indent': ['error', 2],

    // è¡Œå°¾ç©ºæ ¼
    'no-trailing-spaces': 'error'
  }
};
```

### 9.2 å¼‚æ­¥æ“ä½œè§„èŒƒ
**ä¼˜å…ˆä½¿ç”¨ `async/await` è€Œä¸æ˜¯ Promise.then()**

```javascript
// âœ… æ¨èå†™æ³•
async function loadProjectData(projectId) {
  try {
    const project = await projectApi.getProjectDetail(projectId);
    const tasks = await taskApi.getProjectTasks(projectId);
    const members = await projectApi.getProjectMembers(projectId);

    return {
      project,
      tasks,
      members
    };
  } catch (error) {
    console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);
    throw error;
  }
}

// âŒ ä¸æ¨èå†™æ³•
function loadProjectData(projectId) {
  return projectApi.getProjectDetail(projectId)
    .then(project => {
      return taskApi.getProjectTasks(projectId)
        .then(tasks => {
          return projectApi.getProjectMembers(projectId)
            .then(members => {
              return { project, tasks, members };
            });
        });
    })
    .catch(error => {
      console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);
      throw error;
    });
}
```

### 9.3 é”™è¯¯å¤„ç†è§„èŒƒ
```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼
async function handleAsyncOperation() {
  try {
    const result = await someAsyncOperation();
    return result;
  } catch (error) {
    // è®°å½•é”™è¯¯
    console.error('æ“ä½œå¤±è´¥:', error);

    // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
    wx.showToast({
      title: 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•',
      icon: 'error'
    });

    // é‡æ–°æŠ›å‡ºé”™è¯¯ä¾›ä¸Šå±‚å¤„ç†
    throw error;
  }
}
```

### 9.4 ä»£ç æ³¨é‡Šè§„èŒƒ
```javascript
/**
 * è·å–é¡¹ç›®è¯¦æƒ…å’Œç›¸å…³æ•°æ®
 * @param {string} projectId - é¡¹ç›®ID
 * @param {Object} options - å¯é€‰å‚æ•°
 * @param {boolean} options.includeTasks - æ˜¯å¦åŒ…å«ä»»åŠ¡åˆ—è¡¨
 * @param {boolean} options.includeMembers - æ˜¯å¦åŒ…å«æˆå‘˜åˆ—è¡¨
 * @returns {Promise<Object>} é¡¹ç›®è¯¦æƒ…æ•°æ®
 */
async function getProjectDetail(projectId, options = {}) {
  const { includeTasks = true, includeMembers = true } = options;

  // è·å–åŸºç¡€é¡¹ç›®ä¿¡æ¯
  const project = await projectApi.getProjectDetail(projectId);

  // æ ¹æ®é€‰é¡¹è·å–é¢å¤–æ•°æ®
  const additionalData = {};

  if (includeTasks) {
    additionalData.tasks = await taskApi.getProjectTasks(projectId);
  }

  if (includeMembers) {
    additionalData.members = await projectApi.getProjectMembers(projectId);
  }

  return {
    ...project,
    ...additionalData
  };
}
```

---

## 10. å¾®ä¿¡å°ç¨‹åºæœ€ä½³å®è·µ

### 10.1 åˆ†åŒ…ç­–ç•¥
**ä¸»åŒ… (Main Package)ï¼š** æ ¸å¿ƒåŠŸèƒ½ï¼Œæ§åˆ¶åœ¨2MBä»¥å†…
- ç™»å½•æ³¨å†Œ
- é¡¹ç›®åˆ—è¡¨
- é¡¹ç›®è¯¦æƒ…
- ä»»åŠ¡ç®¡ç†æ ¸å¿ƒåŠŸèƒ½

**åˆ†åŒ… (Sub Packages)ï¼š** æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†
```json
{
  "pages": [
    "pages/index/index",
    "pages/login/login",
    "pages/project-list/project-list",
    "pages/project-detail/project-detail"
  ],
  "subpackages": [
    {
      "root": "subpackages/chat",
      "name": "chat",
      "pages": [
        "pages/chat-room/chat-room",
        "pages/chat-list/chat-list"
      ]
    },
    {
      "root": "subpackages/finance",
      "name": "finance",
      "pages": [
        "pages/expense-record/expense-record",
        "pages/budget-manage/budget-manage"
      ]
    },
    {
      "root": "subpackages/admin",
      "name": "admin",
      "pages": [
        "pages/user-manage/user-manage",
        "pages/project-settings/project-settings"
      ]
    }
  ],
  "preloadRule": {
    "pages/project-detail/project-detail": {
      "network": "all",
      "packages": ["chat"]
    }
  }
}
```

### 10.2 ç»„ä»¶åŒ–å¼€å‘
**ç»„ä»¶è®¾è®¡åŸåˆ™ï¼š**
- å•ä¸€èŒè´£ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- å¯å¤ç”¨æ€§ï¼šç»„ä»¶åº”è¯¥åœ¨å¤šä¸ªåœºæ™¯ä¸‹å¯ç”¨
- æ•°æ®é©±åŠ¨ï¼šé€šè¿‡propsä¼ é€’æ•°æ®ï¼Œé€šè¿‡eventsé€šä¿¡

**ä»»åŠ¡å¡ç‰‡ç»„ä»¶ç¤ºä¾‹ï¼š**
```javascript
// miniprogram/components/task-card/task-card.js
Component({
  properties: {
    task: {
      type: Object,
      value: {}
    },
    showActions: {
      type: Boolean,
      value: true
    },
    userRole: {
      type: String,
      value: 'owner'
    }
  },

  data: {
    statusMap: {
      'pending': 'å¾…å¼€å§‹',
      'in_progress': 'è¿›è¡Œä¸­',
      'completed': 'å·²å®Œæˆ',
      'accepted': 'å·²éªŒæ”¶'
    }
  },

  methods: {
    onTaskClick() {
      this.triggerEvent('taskclick', {
        taskId: this.data.task.id
      });
    },

    onAcceptanceRequest() {
      this.triggerEvent('acceptancerequest', {
        taskId: this.data.task.id
      });
    },

    onStatusChange(event) {
      const newStatus = event.detail.value;
      this.triggerEvent('statuschange', {
        taskId: this.data.task.id,
        newStatus
      });
    }
  }
});
```

### 10.3 setDataä¼˜åŒ–æŠ€å·§
**æ‰¹é‡æ›´æ–°ï¼š**
```javascript
// âœ… æ¨èï¼šæ‰¹é‡æ›´æ–°
this.setData({
  'project.name': newName,
  'project.status': newStatus,
  'project.updatedAt': new Date().toISOString(),
  loading: false
});

// âŒ ä¸æ¨èï¼šå¤šæ¬¡è°ƒç”¨setData
this.setData({ 'project.name': newName });
this.setData({ 'project.status': newStatus });
this.setData({ 'project.updatedAt': new Date().toISOString() });
this.setData({ loading: false });
```

**æ•°æ®å·®å¼‚æ›´æ–°ï¼š**
```javascript
// åªæ›´æ–°å˜åŒ–çš„æ•°æ®
updateTaskList(newTasks) {
  const currentTasks = this.data.tasks;
  const updates = {};

  newTasks.forEach((task, index) => {
    if (!currentTasks[index] || currentTasks[index].id !== task.id) {
      updates[`tasks[${index}]`] = task;
    } else {
      // æ£€æŸ¥ä»»åŠ¡å±æ€§æ˜¯å¦æœ‰å˜åŒ–
      Object.keys(task).forEach(key => {
        if (currentTasks[index][key] !== task[key]) {
          updates[`tasks[${index}].${key}`] = task[key];
        }
      });
    }
  });

  if (Object.keys(updates).length > 0) {
    this.setData(updates);
  }
}
```

### 10.4 å†…å­˜ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸä¼˜åŒ–
```javascript
// é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†
Page({
  data: {
    timer: null,
    observer: null
  },

  onLoad() {
    // åˆå§‹åŒ–
    this.initPage();
  },

  onShow() {
    // é¡µé¢æ˜¾ç¤ºæ—¶å¯åŠ¨å®šæ—¶å™¨
    this.startTimer();
    // ç›‘å¬ç½‘ç»œçŠ¶æ€
    this.watchNetworkStatus();
  },

  onHide() {
    // é¡µé¢éšè—æ—¶æ¸…ç†å®šæ—¶å™¨
    this.clearTimer();
  },

  onUnload() {
    // é¡µé¢å¸è½½æ—¶æ¸…ç†æ‰€æœ‰èµ„æº
    this.cleanup();
  },

  startTimer() {
    this.data.timer = setInterval(() => {
      this.refreshData();
    }, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
  },

  clearTimer() {
    if (this.data.timer) {
      clearInterval(this.data.timer);
      this.setData({ timer: null });
    }
  },

  watchNetworkStatus() {
    this.data.observer = wx.onNetworkStatusChange((res) => {
      if (res.isConnected) {
        this.refreshData();
      }
    });
  },

  cleanup() {
    this.clearTimer();
    if (this.data.observer) {
      wx.offNetworkStatusChange(this.data.observer);
    }
  }
});
```

### 10.5 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
**å›¾ç‰‡ä¼˜åŒ–ï¼š**
```javascript
// å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶
Component({
  properties: {
    src: String,
    defaultSrc: String
  },

  data: {
    loaded: false,
    currentSrc: ''
  },

  lifetimes: {
    attached() {
      this.setData({
        currentSrc: this.data.defaultSrc || '/static/images/placeholder.png'
      });
      this.observeImage();
    }
  },

  methods: {
    observeImage() {
      const observer = this.createIntersectionObserver();
      observer.relativeToViewport().observe('.lazy-image', (res) => {
        if (res.intersectionRatio > 0) {
          this.loadImage();
          observer.disconnect();
        }
      });
    },

    loadImage() {
      if (this.data.src) {
        this.setData({
          currentSrc: this.data.src,
          loaded: true
        });
      }
    }
  }
});
```

**åˆ—è¡¨ä¼˜åŒ–ï¼š**
```javascript
// è™šæ‹Ÿåˆ—è¡¨å®ç°
Page({
  data: {
    allTasks: [],
    visibleTasks: [],
    scrollTop: 0,
    itemHeight: 120,
    containerHeight: 600,
    startIndex: 0,
    endIndex: 0
  },

  onLoad() {
    this.calculateVisibleItems();
  },

  onScroll(event) {
    const scrollTop = event.detail.scrollTop;
    this.setData({ scrollTop });
    this.updateVisibleItems(scrollTop);
  },

  calculateVisibleItems() {
    const { containerHeight, itemHeight } = this.data;
    const visibleCount = Math.ceil(containerHeight / itemHeight) + 2; // ç¼“å†²2ä¸ª
    this.setData({ visibleCount });
  },

  updateVisibleItems(scrollTop) {
    const { itemHeight, visibleCount, allTasks } = this.data;
    const startIndex = Math.floor(scrollTop / itemHeight);
    const endIndex = Math.min(startIndex + visibleCount, allTasks.length);

    const visibleTasks = allTasks.slice(startIndex, endIndex).map((task, index) => ({
      ...task,
      _index: startIndex + index
    }));

    this.setData({
      startIndex,
      endIndex,
      visibleTasks
    });
  }
});
```

### 10.6 äº‘å¼€å‘æœ€ä½³å®è·µ
**äº‘å‡½æ•°ç»„ç»‡ï¼š**
```javascript
// äº‘å‡½æ•°ç»Ÿä¸€å…¥å£
// cloudfunctions/api/index.js
const cloud = require('wx-server-sdk');
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV });

const userHandler = require('./handlers/user');
const projectHandler = require('./handlers/project');
const taskHandler = require('./handlers/task');

exports.main = async (event, context) => {
  const { method, resource, data } = event;

  try {
    switch (resource) {
      case 'user':
        return await userHandler[method](data, context);
      case 'project':
        return await projectHandler[method](data, context);
      case 'task':
        return await taskHandler[method](data, context);
      default:
        throw new Error('Unknown resource');
    }
  } catch (error) {
    console.error('API Error:', error);
    return {
      code: 5000,
      message: error.message,
      data: null
    };
  }
};
```

**æ•°æ®åº“æ“ä½œä¼˜åŒ–ï¼š**
```javascript
// æ‰¹é‡æ“ä½œ
async function batchUpdateTasks(taskUpdates) {
  const db = cloud.database();
  const batch = db.batch();

  taskUpdates.forEach(update => {
    batch.collection('tasks').doc(update.id).update({
      data: update.data
    });
  });

  return await batch.commit();
}

// èšåˆæŸ¥è¯¢
async function getProjectStatistics(projectId) {
  const db = cloud.database();
  const $ = db.command.aggregate;

  return await db.collection('tasks')
    .aggregate()
    .match({ projectId })
    .group({
      _id: '$status',
      count: $.sum(1)
    })
    .end();
}
```

---

## ğŸ“š æ€»ç»“

æœ¬æ–‡æ¡£å®šä¹‰äº†"è‡ªå·±è£…"è£…ä¿®ååŒå¹³å°çš„å®Œæ•´å¼€å‘è§„èŒƒï¼Œæ¶µç›–ï¼š

1. **æ¶æ„åŸåˆ™** - ä¸¥æ ¼çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œç¡®ä¿ä»£ç å¯ç»´æŠ¤æ€§
2. **çŠ¶æ€ç®¡ç†** - åŸºäºMobXçš„å…¨å±€çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ
3. **å¼€å‘è§„èŒƒ** - ä»å‘½ååˆ°ä»£ç é£æ ¼çš„å…¨é¢æ ‡å‡†
4. **æ€§èƒ½ä¼˜åŒ–** - å¾®ä¿¡å°ç¨‹åºç‰¹æœ‰çš„ä¼˜åŒ–ç­–ç•¥

**ğŸ¯ æ ¸å¿ƒè¦æ±‚ï¼š**
- æ‰€æœ‰å¼€å‘å¿…é¡»éµå¾ªæœ¬æ–‡æ¡£è§„èŒƒ
- AIåŠ©æ‰‹å¿…é¡»ä»¥æœ¬æ–‡æ¡£ä¸ºæœ€é«˜å‡†åˆ™
- ä»»ä½•æ¶æ„å˜æ›´éœ€è¦æ›´æ–°æœ¬æ–‡æ¡£

**ğŸ“ˆ æŒç»­æ”¹è¿›ï¼š**
- å®šæœŸreviewå’Œæ›´æ–°è§„èŒƒ
- æ ¹æ®é¡¹ç›®å‘å±•è°ƒæ•´æ¶æ„
- ä¿æŒæ–‡æ¡£ä¸ä»£ç åŒæ­¥

---

*æœ€åæ›´æ–°ï¼š2024-01-01*
*ç‰ˆæœ¬ï¼šv1.0*
*ç»´æŠ¤è€…ï¼šé¡¹ç›®æ¶æ„å›¢é˜Ÿ*
